suite: test ecr secret
templates:
  - ecr-secret.yaml
tests:
  - it: should create ecr secret
    set:
      externalSecrets.ecr.token: test-token-123
      externalSecrets.ecr.server: test.dkr.ecr.us-east-1.amazonaws.com
      externalSecrets.ecr.username: AWS
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: metadata.name
          value: ecr-secret
      - equal:
          path: type
          value: kubernetes.io/dockerconfigjson

  - it: should have correct namespace
    set:
      namespace.name: test-namespace
    asserts:
      - equal:
          path: metadata.namespace
          value: test-namespace

  - it: should have docker config data when token is provided
    set:
      externalSecrets.ecr.token: test-token
      externalSecrets.ecr.server: test.server.com
      externalSecrets.ecr.username: testuser
    asserts:
      - isNotEmpty:
          path: data[".dockerconfigjson"]

  - it: should not create secret when token is empty
    set:
      externalSecrets.ecr.token: ""
    asserts:
      - hasDocuments:
          count: 0

  - it: should have correct labels
    set:
      externalSecrets.ecr.token: test-token
    asserts:
      - equal:
          path: metadata.labels.app
          value: ecr-secret
      - equal:
          path: metadata.labels.release
          value: RELEASE-NAME 