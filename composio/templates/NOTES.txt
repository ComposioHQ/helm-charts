1. Get the application URL by running these commands:
{{- if contains "NodePort" .Values.apollo.service.type }}
  export NODE_PORT=$(kubectl get --namespace {{ .Release.Namespace }} -o jsonpath="{.spec.ports[0].nodePort}" services {{ include "composio.fullname" . }}-apollo)
  export NODE_IP=$(kubectl get nodes --namespace {{ .Release.Namespace }} -o jsonpath="{.items[0].status.addresses[0].address}")
  echo http://$NODE_IP:$NODE_PORT
{{- else if contains "LoadBalancer" .Values.apollo.service.type }}
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace {{ .Release.Namespace }} svc -w {{ include "composio.fullname" . }}-apollo'
  export SERVICE_IP=$(kubectl get svc --namespace {{ .Release.Namespace }} {{ include "composio.fullname" . }}-apollo --template "{{"{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}"}}")
  echo http://$SERVICE_IP:{{ .Values.apollo.service.port }}
{{- else if contains "ClusterIP" .Values.apollo.service.type }}
  export POD_NAME=$(kubectl get pods --namespace {{ .Release.Namespace }} -l "app.kubernetes.io/name={{ include "composio.name" . }},app.kubernetes.io/instance={{ .Release.Name }},app.kubernetes.io/component=apollo" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace {{ .Release.Namespace }} $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace {{ .Release.Namespace }} port-forward $POD_NAME 8080:$CONTAINER_PORT
{{- end }}

2. Access Composio services:

   Apollo (Main API):
   kubectl port-forward --namespace {{ .Release.Namespace }} svc/{{ include "composio.fullname" . }}-apollo 8080:{{ .Values.apollo.service.port }}
   Then visit: http://127.0.0.1:8080

{{- if .Values.thermos.replicaCount }}
   Thermos (Workflow Engine):
   kubectl port-forward --namespace {{ .Release.Namespace }} svc/{{ .Release.Name }}-thermos 8180:{{ .Values.thermos.service.port }}
   Then visit: http://127.0.0.1:8180
{{- end }}

{{- if and .Values.mercury.enabled (not .Values.mercury.useKnative) }}
   Mercury (Lambda Runtime):
   kubectl port-forward --namespace {{ .Release.Namespace }} svc/{{ include "composio.fullname" . }}-mercury 8080:80
   Then visit: http://127.0.0.1:8080
{{- end }}

{{- if .Values.frontend.enabled }}
   Frontend (Web UI):
   kubectl port-forward --namespace {{ .Release.Namespace }} svc/{{ include "composio.fullname" . }}-frontend 3000:{{ .Values.frontend.service.port }}
   Then visit: http://127.0.0.1:3000
{{- end }}

   Temporal Web UI:
   kubectl port-forward --namespace {{ .Release.Namespace }} svc/{{ .Release.Name }}-temporal-web 8082:8080
   Then visit: http://127.0.0.1:8082

{{- if and .Values.otel.enabled .Values.otel.collector.enabled }}
   OpenTelemetry Collector (Metrics/Traces):
   kubectl port-forward --namespace {{ .Release.Namespace }} svc/{{ .Release.Name }}-otel-collector 8889:8889
   Then visit: http://127.0.0.1:8889/metrics
{{- end }}


3. Verify installation:
   kubectl get pods --namespace {{ .Release.Namespace }} -l app.kubernetes.io/instance={{ .Release.Name }}

   All pods should be in 'Running' status.

4. Ingress Configuration:
{{- if .Values.apollo.ingress.enabled }}
   - Apollo ingress is enabled at: {{ .Values.apollo.ingress.host }}
{{- end }}
{{- if and .Values.mercury.enabled .Values.mercury.ingress.enabled }}
   - Mercury ingress is enabled at: {{ .Values.mercury.ingress.host | default (printf "mercury.%s" .Values.global.domain) }}
{{- end }}
{{- if and .Values.frontend.enabled .Values.frontend.ingress.enabled }}
   - Frontend ingress is enabled at: {{ .Values.frontend.ingress.host | default (printf "app.%s" .Values.global.domain) }}
{{- end }}
{{- if not (or .Values.apollo.ingress.enabled (and .Values.mercury.enabled .Values.mercury.ingress.enabled) (and .Values.frontend.enabled .Values.frontend.ingress.enabled)) }}
   - No ingress configured. Use port-forward commands above or configure ingress in values.yaml
{{- end }}

5. For production use:
   - Configure external databases (PostgreSQL, Redis)
   - Set up proper ingress with SSL certificates for Apollo, Mercury, and Frontend
   - Configure monitoring and logging (OpenTelemetry collector is {{ if .Values.otel.enabled }}enabled{{ else }}disabled{{ end }})
   - Review security settings and secrets management
{{- if .Values.mercury.useKnative }}
   - Mercury is configured to use Knative Serving for serverless scaling
{{- end }}

For more information:
- Documentation: https://docs.composio.dev
- GitHub: https://github.com/composio/self-hosted
- Support: https://discord.gg/composio


{{- if and .Values.redis.enabled .Values.redis.auth.enabled (not .Values.redis.auth.password) }}

INFO: Redis password will be auto-managed by the chart for security.
{{- end }} 